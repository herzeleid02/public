<!-- vim-markdown-toc GFM -->

* [Рекомендации по обеспечению информационной безопасности](#Рекомендации-по-обеспечению-информационной-безопасности)
    * [Общие рекомендации](#Общие-рекомендации)
    * [Рекомендации для работы с контейнерами](#Рекомендации-для-работы-с-контейнерами)
* [Практика предотвращения несанкционированного доступа](#Практика-предотвращения-несанкционированного-доступа)
    * [Отображение свойств пользователя `apache`](#Отображение-свойств-пользователя-apache)
        * [Файл `/etc/passwd`](#Файл-etcpasswd)
    * [Краткая информация про группы](#Краткая-информация-про-группы)
        * [Пользовательские группы](#Пользовательские-группы)
    * [Настройка SSH](#Настройка-ssh)
    * [Поиск сведений о недавнем входе в систему всех пользователей](#Поиск-сведений-о-недавнем-входе-в-систему-всех-пользователей)
    * [Отключение ненужных сервисов в системе](#Отключение-ненужных-сервисов-в-системе)
    * [Отображение текущих терминальных сессий](#Отображение-текущих-терминальных-сессий)

<!-- vim-markdown-toc -->
# Рекомендации по обеспечению информационной безопасности
## Общие рекомендации

+ Сегментация сети
+ Наличие средств и политик для предотвращения утечки данных
+ Настройка систем для обнаружения уязвимостей (SIEM)
+ Отключение ненужных сервисов 
+ Запрет входа пользователя `apache` по SSH
+ Обновление ПО
+ Использование только официальных источников ПО
+ Правильная настройка прав и привилегий для пользователя `apache` (Доступ к shell-программам, доступ к sudo, наличие членства только в необходимых для работы сервиса групп)
+ Разрешениe доступа пользователю `apache` только к важным для работы сервисов объектам 
+ Опционально -- изоляция сервисов в контейнере/отдельной машине

## Рекомендации для работы с контейнерами

+ Использование минимальных образов ОС для контейнеров
+ Использование оптимизированных ОС для работы с контейнерами
+ Оптимизация сборок контейнеров (в контейнере должны быть только необходимые для работы ПО файлы)
+ Использование только необходимых частей хостовой ОС (например, модулей ядра)
+ Подключение только необходимых директорий к контейнеру
+ Запуск контейнеров от непривилегированного пользователя
+ Отказ от использования неофициальных публичных образов контейнеров
+ Отказ от хранения паролей, ключей или личной информации внутри контейнеров

# Практика предотвращения несанкционированного доступа

## Отображение свойств пользователя `apache`
Отображение идентификаторов пользователя и связанных с ним групп:
```
id apache
```
Отображение групп, в которой состоит пользователь `apache`:
```
groups apache
```
### Файл `/etc/passwd`
_из [manpages.ubuntu.com](https://manpages.ubuntu.com/manpages/xenial/ru/man5/passwd.5.html)_:
>Файл /etc/passwd содержит учётные записи пользователей, по одной в каждой строке. Строка состоит из семи полей, разделённых двоеточиями («:»). Поля:
>
>+ имя пользователя для входа в систему
>+ необязательный зашифрованный пароль
>+ числовой идентификатор пользователя
>+ числовой идентификатор группы
>+ ФИО пользователя или поле комментария
>+ домашний каталог пользователя
>+ необязательный интерпретатор командной строки пользователя

Типичная строчка для пользователя `apache` может выглядеть вот так (типичный пример для обычного пользователя):
```
apache:x:1002:1002::/home/apache:/bin/bash
```
Где мы видим `/bin/bash` -- командный интерпретатор по-умолчанию для пользователя. Для сравнения пример стандартной строки файла `/etc/passwd` для веб-сервиса Nginx:
```
nginx:x:458:458:User for nginx:/var/lib/nginx:/usr/sbin/nologin
```
`/usr/bin/nologin` -- механизм отключения доступа. (так же вход в такой аккаунт отключен через `!` в `/etc/shadow`)

_из [manpages.ubuntu.com](https://manpages.ubuntu.com/manpages/xenial/ru/man5/passwd.5.html):_
>nologin - вежливо отказывает во входе в систему

Пользователь `apache` существует для запуска от его имени сервиса -- а значит прямой доступ (способность входа в него через обычные механизмы) не нужен.

## Краткая информация про группы

### Пользовательские группы
| Группа          | Файлы                                                                                                 | Назначение                                                                                                                                                                                |
|-----------------|-------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| adm             |                                                                                                       | Группа администрирования, обычно используется для чтения файлов защищённых логов. Позволяет читать файлы журнала.                                                                         |
| ftp             | `/srv/ftp/`                                                                                           | Доступ к файлам FTP-сервера.                                                                                                                                                              |
| games           | `/var/games`                                                                                          | Доступ к некоторым игровым программам.                                                                                                                                                    |
| http            | `/srv/http/`                                                                                          | Доступ к файлам HTTP-сервера.                                                                                                                                                             |
| log             |                                                                                                       | Доступ к файлам логов в каталоге /var/log/, созданным syslog-ng.                                                                                                                          |
| rfkill          | `/dev/rfkill`                                                                                         | Управление питанием беспроводных устройств (используется rfkill).                                                                                                                         |
| sys             |                                                                                                       | Администрирование с помощью CUPS.                                                                                                                                                         |
| systemd-journal |                                                                                                       | /var/log/journal/* 	Может использоваться как альтернатива группам adm и wheel для чтения журналов systemd [1]. В противном случае отображаются только сообщения, созданные пользователем. |
| uucp            | `/dev/ttyS[0-9]+`,   `/dev/tts/[0-9]+`, `/dev/ttyUSB[0-9]+`, `/dev/ttyACM[0-9]+`, `/dev/rfcomm[0-9]+` | Последовательные порты RS-232 и подключенные к ним устройства.                                                                                                                            |
| wheel*          |                                                                                                       | Группа администрирования, даёт необходимые права. Имеет доступ к файлам журнала и принтерам в CUPS. Также позволяет работать с утилитами sudo и su (по умолчанию их не использует).       |

*На большинстве .deb-основанных(Debian, Ubuntu) группа называется `sudo`.

В зависимости от установленного ПО, список групп будет отличаться. Например, для взаимодействия с виртуальными машинами через интерфейс libvirt необходимо добавить пользователя в группу `libvirt`.

[Подробнее](https://wiki.archlinux.org/title/Users_and_groups)

## Настройка SSH
Для запрета создания SSH-подключения через пользователя `apache` необходимо отредактировать файл `/etc/ssh/sshd_config`, добавив туда строчку 
, можно запретить всем вход и держать список разрешенных ко входу пользователей с помощью строчки 
```
AllowUsers USER USER2
```
или разрешить доступ по SSH только участникам группы `sshusers`.
```
AllowUsers sshusers
```
Подробнее можно прочитать с помощью `man sshd_config`, а так же на [man.openssh.org](https://man.openbsd.org/sshd_config)

## Поиск сведений о недавнем входе в систему всех пользователей
```
lastlog
```
Отображение только пользователя `apache`
```
lastlog -u
```

## Отключение ненужных сервисов в системе
Большая часть ОС на базе GNU/Linux использует systemd в качестве своей подсистемы инициализации. Systemd отвечает за работу сервисов в системе. Для отображения всех доступных на системе сервисов можно использовать команду
```
systemctl list-unit-files
```
для выключения сервиса `sshd` и его последующего отключения (сервис `sshd не будет включен по-умолчанию при перезапуске системы) можно использовать команду (необходимы права суперпользователя)
```
systemctl disable --now sshd
```

## Отображение текущих терминальных сессий
Для отображения текущих терминальный сессий в системе можно выполнить данную команду от суперпользователя:
```
who
```
Типичныe выходные данные команды `sudo who`:
```
user1 tty1         Sep 11 21:20
user1 pts/0        Sep 11 19:37 (192.168.122.1)
user2    pts/1        Sep 11 21:20 (192.168.122.1)
user1 pts/2        Sep 11 21:20 (192.168.122.1)
```

